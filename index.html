<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AstuPorra</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fuentes personalizadas -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos generales */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #111827; /* Gris muy oscuro */
            color: #e5e7eb; /* Gris claro */
        }
        h1, h2, h3 {
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
        }

        /* Estilos de las tarjetas de comodín */
        .card {
            background-color: #1f2937; /* Gris oscuro */
            border-radius: 0.75rem;
            border: 1px solid #374151; /* Borde sutil */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, border-color 0.2s;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            border-color: #4b5563; /* Borde un poco más claro al pasar el ratón */
        }

        /* Estilos para el estado seleccionado */
        .card.selected-favor {
            border: 3px solid #10b981; /* Verde esmeralda */
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
            background-color: #064e3b; /* Fondo verde oscuro */
        }

        .card.selected-contra {
            border: 3px solid #ef4444; /* Rojo */
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.6);
            background-color: #7f1d1d; /* Fondo rojo oscuro */
        }

        /* Estilos de los botones de filtro */
        .filter-btn {
            background-color: #374151;
            color: #f3f4f6;
            transition: background-color 0.2s;
        }
        .filter-btn:hover {
            background-color: #4b5563;
        }

        /* Colores específicos de los botones de filtro de tipo */
        .filter-btn-favor {
            background-color: #059669 !important; /* Verde */
        }
        .filter-btn-favor:hover {
            background-color: #047857 !important;
        }
        .filter-btn-contra {
            background-color: #dc2626 !important; /* Rojo */
        }
        .filter-btn-contra:hover {
            background-color: #b91c1c !important;
        }

        .filter-btn.active:not(.filter-btn-favor):not(.filter-btn-contra):not(.filter-btn-view) {
            background-color: #4f46e5; /* Índigo para "Todos" */
        }
        
        /* Estilo del botón de "Ver Selecciones" */
        .filter-btn-view.active {
             background-color: #f59e0b !important; /* Ámbar */
             color: #1f2937 !important;
        }
        .filter-btn-view:hover {
             background-color: #d97706 !important;
        }


        /* Estilo del texto del comodín */
        .favor-text {
            color: #10b981; /* Verde esmeralda */
        }

        .contra-text {
            color: #ef4444; /* Rojo */
        }

        /* Estilos de las tablas */
        .table-header {
            background-color: #374151;
            color: #f3f4f6;
            text-transform: uppercase;
        }

        .table-row-odd {
            background-color: #1f2937;
        }

        .table-row-even {
            background-color: #111827;
        }
        
        /* Estilo para el avatar */
        .avatar {
            width: 32px;
            height: 32px;
            object-fit: cover;
            border-radius: 50%;
            margin-right: 12px;
            border: 2px solid #6366f1; /* Borde índigo */
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Contenedor principal centrado -->
    <div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Encabezado y Título -->
        <header class="text-center mb-10 border-b-2 border-indigo-500 pb-4">
            <h1 class="text-5xl font-bold text-indigo-400 tracking-wider">AstuPorra</h1>
            <p class="text-lg text-gray-400 mt-2">La Quiniela Definitiva de Wrestling</p>
        </header>

        <!-- Navegación de pestañas -->
        <div class="mb-8 flex space-x-4 border-b border-gray-700">
            <button class="tab-button p-3 font-semibold text-lg border-b-4 border-indigo-500 text-indigo-400 transition duration-300" data-tab="reglas">
                Reglas y Comodines
            </button>
            <button class="tab-button p-3 font-semibold text-lg text-gray-400 hover:text-indigo-400 transition duration-300" data-tab="clasificacion">
                Clasificación
            </button>
        </div>

        <!-- Contenido de las Pestañas -->
        
        <!-- Pestaña 1: Reglas y Comodines -->
        <div id="reglas" class="tab-content">
            
            <!-- Reglas Fundamentales -->
            <section class="mb-10 p-6 bg-gray-800 rounded-xl shadow-2xl border border-gray-700">
                <h2 class="text-3xl font-bold mb-4 text-yellow-400">Reglas Fundamentales</h2>
                <ul class="list-disc list-inside space-y-2 text-gray-300 ml-4">
                    <li><span class="font-bold text-yellow-300">Uso entre participantes de la misma división:</span> Los comodines solo se pueden usar contra otros participantes de tu misma división (1ª División contra 1ª División, 2ª División contra 2ª División).</li>
                    <li><span class="font-bold text-yellow-300">Un comodín por PPV/PLE:</span> Solo puedes elegir y usar un único comodín por evento (PPV/PLE).</li>
                    <li><span class="font-bold text-yellow-300">Dos ataques por evento:</span> Un oponente solo puede ser atacado un máximo de dos veces por evento.</li>
                </ul>
            </section>

            <!-- Proceso de Selección de Comodín -->
            <section class="mb-10 p-6 bg-gray-800 rounded-xl shadow-2xl border border-gray-700">
                <h2 class="text-3xl font-bold mb-4 text-pink-400">Proceso de Selección de Comodín</h2>
                <div class="space-y-4">
                    <div class="flex items-start">
                        <span class="text-2xl font-bold mr-4 text-pink-400">1.</span>
                        <p class="text-gray-300">El orden de los turnos para la elección de comodín se determinará por la <span class="font-bold text-pink-300">clasificación del evento anterior</span> (el último PPV/PLE). El último clasificado elige primero, y el primero, el último.</p>
                    </div>
                    <div class="flex items-start">
                        <span class="text-2xl font-bold mr-4 text-pink-400">2.</span>
                        <p class="text-gray-300">Cada participante tendrá <span class="font-bold text-pink-300">12 horas</span> para elegir su comodín una vez le toque el turno. De no hacerlo, perderá su oportunidad de usar comodín en dicho evento.</p>
                    </div>
                </div>
            </section>

            <!-- Explorador de Comodines -->
            <section class="p-6 bg-gray-900 rounded-xl shadow-2xl border border-indigo-700">
                <h2 class="text-4xl font-bold mb-6 text-indigo-400">Explorador de Comodines</h2>
                
                <!-- Resumen de selección y Formulario de Envío (Válido solo para UN comodín) -->
                <div id="summary-box" class="mb-6 p-4 rounded-lg bg-gray-700 border border-gray-600 hidden">
                    <h3 class="text-xl font-bold mb-2 text-indigo-300">Comodines Seleccionados: <span id="selection-count" class="font-extrabold text-white">0</span></h3>
                    
                    <div id="selected-wildcard-list" class="mb-4 space-y-2">
                        <!-- Aquí se lista el comodín seleccionado -->
                    </div>
                    
                    <form id="selection-form" class="space-y-3">
                        <input type="text" id="discord-user-selector" placeholder="@Tu Usuario de Discord (Ej: @SrKaiser)" 
                            class="w-full p-3 rounded-lg bg-gray-800 border border-gray-600 focus:ring-green-500 focus:border-green-500 text-gray-200" required>
                        
                        <button type="submit" id="send-button" disabled
                            class="w-full bg-gray-500 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
                            Selecciona 1 comodín para Enviar a Discord
                        </button>
                    </form>

                    <!-- Mensaje de estado (éxito/error) -->
                    <div id="status-message" class="mt-4 p-3 rounded-lg text-sm font-medium hidden"></div>

                </div>

                <!-- Filtros -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <!-- Búsqueda -->
                    <input type="text" id="search-input" placeholder="Buscar por nombre o efecto..." 
                        class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 text-gray-200 col-span-full md:col-span-2">

                    <!-- Uso (Timing) -->
                    <select id="uso-filter" class="p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 text-gray-200">
                        <option value="all">Uso (Timing)</option>
                        <option value="Antes">Antes</option>
                        <option value="Durante">Durante</option>
                        <option value="Después">Después</option>
                        <option value="Antes / Durante">Antes / Durante</option>
                        <option value="Durante / Después">Durante / Después</option>
                    </select>

                    <!-- Orientación (Alcance) -->
                    <select id="orientacion-filter" class="p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 text-gray-200">
                        <option value="all">Orientación (Alcance)</option>
                        <option value="Media / Baja">Media / Baja</option>
                        <option value="Divisional">Divisional</option>
                        <option value="General">General</option>
                        <option value="2ª División">2ª División</option>
                    </select>
                </div>

                <!-- Filtros de Tipo y Visibilidad -->
                <div class="flex flex-wrap gap-3 mb-8">
                    <button class="filter-btn p-2 rounded-lg font-semibold" data-filter-type="all">Todos</button>
                    <button class="filter-btn p-2 rounded-lg font-semibold" data-filter-type="favor">A Favor</button>
                    <button class="filter-btn p-2 rounded-lg font-semibold" data-filter-type="contra">En Contra</button>
                    <!-- Este botón ahora mostrará la lista de selecciones múltiples -->
                    <button id="view-selection-btn" class="filter-btn filter-btn-view p-2 rounded-lg font-semibold" data-filter-type="selection">
                        Ver mi Selección (0)
                    </button>
                </div>

                <!-- Contenedor de Comodines -->
                <div id="wildcard-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Las tarjetas de comodines se insertarán aquí con JavaScript -->
                </div>
            </section>
        </div>

        <!-- Pestaña 2: Clasificación (Contenido generado por JS) -->
        <div id="clasificacion" class="tab-content hidden">
            
            <h2 class="text-4xl font-bold mb-6 text-indigo-400 text-center">Clasificación General</h2>

            <!-- Contenedor de la 1ª División -->
            <section class="mb-10">
                <h3 class="text-3xl font-bold mb-4 text-green-400 text-center border-b border-green-700 pb-2">1ª División</h3>
                <div class="overflow-x-auto rounded-lg shadow-xl">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead>
                            <tr>
                                <th class="table-header px-6 py-3 text-left text-xs font-medium tracking-wider w-1/6">Pos.</th>
                                <th class="table-header px-6 py-3 text-left text-xs font-medium tracking-wider w-4/6">Usuario</th>
                                <th class="table-header px-6 py-3 text-right text-xs font-medium tracking-wider w-1/6">Total</th>
                            </tr>
                        </thead>
                        <tbody id="clasificacion-div1" class="divide-y divide-gray-700">
                            <!-- Datos de la 1ª División generados por JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Contenedor de la 2ª División -->
            <section>
                <h3 class="text-3xl font-bold mb-4 text-blue-400 text-center border-b border-blue-700 pb-2">2ª División</h3>
                <div class="overflow-x-auto rounded-lg shadow-xl">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead>
                            <tr>
                                <th class="table-header px-6 py-3 text-left text-xs font-medium tracking-wider w-1/6">Pos.</th>
                                <th class="table-header px-6 py-3 text-left text-xs font-medium tracking-wider w-4/6">Usuario</th>
                                <th class="table-header px-6 py-3 text-right text-xs font-medium tracking-wider w-1/6">Total</th>
                            </tr>
                        </thead>
                        <tbody id="clasificacion-div2" class="divide-y divide-gray-700">
                            <!-- Datos de la 2ª División generados por JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

    </div>

    <script>
        // URL del Webhook de Discord proporcionada por el usuario.
        const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1422665966982270997/0InFBupzK6zYLFE2gq4y6LaLvcqcLjJ-HdJ4KcLotJsvaiJvJ_XIgKWwR6MDhhK81X1O';

        // --- DATOS DE CLASIFICACIÓN Y AVATARES ---
        const standings = {
            division1: [
                { position: '1º', user: 'Fabio', score: 388 },
                { position: '2º', user: 'BlissedAstu', score: 378 },
                { position: '3º', user: 'MrKev719', score: 379 },
                { position: '4º', user: 'Geroo', score: 370 },
                { position: '5º', user: 'Gonsa', score: 349 },
                { position: '6º', user: 'AEKCarlos', score: 346 },
                { position: '7º', user: 'bautiiiii', score: 332 }
            ],
            division2: [
                { position: '1º', user: 'Nelsonageitos', score: 352 },
                { position: '2º', user: 'DannyLopez_90', score: 351 },
                { position: '3º', user: 'jairlopezojeda', score: 338 },
                { position: '4º', user: 'Ruiz24_', score: 297 },
                { position: '5º', user: 'Slyever', score: 270 },
                { position: '6º', user: 'patodiego', score: 192 },
                { position: '7º', user: 'dany_1208', score: 98 },
                { position: '8º', user: 'AceSoul', score: 64 }
            ]
        };

        const userAvatars = {
            'Fabio': 'img/Fabio.png',
            'MrKev719': 'img/MrKev719_2.png',
            'BlissedAstu': 'img/BlissedAstu.png',
            'Geroo': 'img/Geroo.png',
            'Gonsa': 'img/Gonsa.png',
            'AEKCarlos': 'img/AEKCarlos.png',
            'bautiiiii': 'img/bautiiiii.png',
            'Nelsonageitos': 'img/Nelsonageitos.png',
            'DannyLopez_90': 'img/DannyLopez_90.png',
            'jairlopezojeda': 'img/jairlopezojeda.png',
            'Ruiz24_': 'img/Ruiz24.png',
            'Slyever': 'img/Slyever.png',
            'patodiego': 'img/patodiego.png',
            'dany_1208': 'img/dany_1208.png',
            'AceSoul': 'img/AceSoul.png'
        };

        // --- DATOS DE COMODINES (SIN CAMBIOS) ---
        const wildcards = [
            // A FAVOR (25)
            { id: 1, name: "Phoenix Splash", type: "favor", explanation: "Si aciertas el ganador del combate inicial del PPV, obtienes un bono de +4 puntos en ese combate.", use: "Después", orientation: "Media / Baja" },
            { id: 2, name: "GTS (Go to Sleep)", type: "favor", explanation: "Puedes \"dormir\" un comodín En Contra que otro usuario de tu misma división haya usado contra ti en este PPV, dejándolo inactivo.", use: "Antes / Durante", orientation: "Divisional" },
            { id: 3, name: "Guerrilla Tactics", type: "favor", explanation: "Si fallas una predicción, puedes usar este comodín para que los puntos de esa predicción no resten, aunque normalmente lo harían.", use: "Después", orientation: "General" },
            { id: 4, name: "Five Knuckle Shuffle", type: "favor", explanation: "Te permite duplicar los puntos obtenidos en una predicción si es un combate sin título en juego.", use: "Antes", orientation: "General" },
            { id: 5, name: "Sweet Chin Music", type: "favor", explanation: "Si predices que el combate terminará por super-kick o finisher de impacto visual, y aciertas, obtienes +3 puntos extra.", use: "Antes", orientation: "General" },
            { id: 6, name: "Foreign Exchange", type: "favor", explanation: "Puedes intercambiar tu predicción menos popular por la más popular de un rival en tu misma división.", use: "Antes", orientation: "Divisional" },
            { id: 7, name: "Macho Madness", type: "favor", explanation: "Si aciertas el resultado de todos los combates con vestimenta extravagante o gimmick particular, obtienes +7 puntos.", use: "Después", orientation: "General" },
            { id: 8, name: "Diamond Cutter", type: "favor", explanation: "Si tu predicción de un combate termina en menos de 3 minutos, y la aciertas, obtienes x3 los puntos.", use: "Después", orientation: "General" },
            { id: 9, name: "Head of the Table", type: "favor", explanation: "Si aciertas la predicción de todos los campeonatos masculinos principales, obtienes un bono de +6 puntos.", use: "Después", orientation: "General" },
            { id: 10, name: "EST of WWE", type: "favor", explanation: "Si aciertas la predicción de todos los campeonatos femeninos principales, obtienes un bono de +6 puntos.", use: "Después", orientation: "General" },
            { id: 11, name: "Countdown Clock", type: "favor", explanation: "Te permite enviar una predicción para un combate específico hasta 1 minuto antes de que comience ese combate.", use: "Durante", orientation: "General" },
            { id: 12, name: "Legend Killer", type: "favor", explanation: "Si predices y aciertas la victoria de una estrella joven sobre un veterano, obtienes +5 puntos extra.", use: "Antes", orientation: "General" },
            { id: 13, name: "Punt Kick", type: "favor", explanation: "Elige a un luchador \"favorito\" (el que más gente predijo); si pierde, obtienes +8 puntos.", use: "Antes", orientation: "General" },
            { id: 14, name: "Rated R Superstar", type: "favor", explanation: "Si aciertas la predicción de un combate que termine por sumisión o rendición, obtienes +4 puntos extra.", use: "Antes", orientation: "General" },
            { id: 15, name: "The List of Jericho", type: "favor", explanation: "Elige a un rival de tu misma división; si aciertas el mismo número de predicciones que él, obtienes +3 puntos adicionales sobre su total.", use: "Después", orientation: "Divisional" },
            { id: 16, name: "People Power", type: "favor", explanation: "Si aciertas la victoria del luchador que es última opción en la predicción de la mayoría, obtienes +5 puntos extra.", use: "Antes", orientation: "Media / Baja" },
            { id: 17, name: "The Viper's RKO", type: "favor", explanation: "Puedes cambiar la predicción de un combate ya cerrado por la que menos gente ha elegido como ganadora.", use: "Antes", orientation: "General" },
            { id: 18, name: "Cesaro Swing", type: "favor", explanation: "Si aciertas una predicción triple o fatal de cuatro esquinas, los puntos se multiplican por x2.", use: "Antes", orientation: "General" },
            { id: 19, name: "Coup de Grâce", type: "favor", explanation: "Si aciertas la predicción del Main Event con una explicación detallada sobre el booking, obtienes +4 puntos extra.", use: "Antes", orientation: "General" },
            { id: 20, name: "Sister Abigail", type: "favor", explanation: "Te permite hacer una doble predicción en un combate: si aciertas ambas (ganador y método), triplicas los puntos.", use: "Antes", orientation: "General" },
            { id: 21, name: "Cross Rhodes", type: "favor", explanation: "Anula una penalización de puntos que te haya impuesto un comodín En Contra de tu misma división.", use: "Durante / Después", orientation: "Divisional" },
            { id: 22, name: "Coast to Coast", type: "favor", explanation: "Si aciertas una predicción de combate de escaleras, mesas o sillas, obtienes +4 puntos extra.", use: "Antes", orientation: "General" },
            { id: 23, name: "Hulk Up", type: "favor", explanation: "Si fallas tu predicción del Main Event, pero tu luchador \"favorito\" gana, se te suma +5 puntos para mitigar la pérdida.", use: "Antes", orientation: "General" },
            { id: 24, name: "Division Ace", type: "favor", explanation: "Elige a un luchador; si tú eres el único de tu división que predice su victoria, y aciertas, obtienes +4 puntos extra.", use: "Antes", orientation: "Divisional" },
            { id: 25, name: "Promotion Play", type: "favor", explanation: "Si eres de la 2ª División y aciertas todos tus combates, obtienes un bono de +10 puntos para el total de la porra.", use: "Después", orientation: "2ª División" },
            
            // EN CONTRA (25)
            { id: 26, name: "Relegation Threat", type: "contra", explanation: "Obligas a que la predicción del Main Event de un rival de tu misma división valga solo 1 punto si acierta.", use: "Antes", orientation: "Divisional" },
            { id: 27, name: "Bottom Feeder Lock", type: "contra", explanation: "La predicción con más puntos de un rival de tu misma división vale 0 si la acierta.", use: "Antes", orientation: "Divisional" },
            { id: 28, name: "Mid-Card Blockade", type: "contra", explanation: "Elige a un rival de la mitad superior de tu misma división; su predicción más popular se le resta -4 puntos si acierta.", use: "Antes", orientation: "Divisional" },
            { id: 29, name: "The Manager's Cut", type: "contra", explanation: "Elige a un rival de tu misma división; si acierta, y ese combate tuvo interferencia de un Manager, pierde -3 puntos.", use: "Antes", orientation: "Divisional" },
            { id: 30, name: "Draw Out", type: "contra", explanation: "Si hay un empate en el número de aciertos entre tú y un rival de tu misma división, puedes restarle -5 puntos del total de la porra.", use: "Después", orientation: "Divisional" },
            { id: 31, name: "Contender’s Trap", type: "contra", explanation: "Elige a un rival de tu misma división; si acierta la predicción de un combate por título secundario, no suma ningún punto.", use: "Antes", orientation: "Divisional" },
            { id: 32, name: "Suspension", type: "contra", explanation: "Elige a un rival de tu misma división; no puede usar ningún comodín en el próximo PPV.", use: "Antes", orientation: "Divisional" },
            { id: 33, name: "Backstage Politics", type: "contra", explanation: "Obliga al rival de tu misma división a que su predicción del combate más largo del PPV valga 0 puntos si acierta.", use: "Antes", orientation: "Divisional" },
            { id: 34, name: "The Curse of the Zone", type: "contra", explanation: "Elige a un rival de tu misma división que vaya en la zona baja; su predicción del Main Event se anula si la acierta.", use: "Antes", orientation: "Divisional" },
            { id: 35, name: "Division Jump", type: "contra", explanation: "Puedes cambiar la predicción del Main Event de un rival de tu misma división a un resultado de Descalificación.", use: "Antes", orientation: "Divisional" },
            { id: 36, name: "Disqualification Push", type: "contra", explanation: "Elige a un rival de tu misma división; su predicción de combate debe ser Descalificación; si acierta, solo suma 1 punto.", use: "Antes", orientation: "Divisional" },
            { id: 37, name: "Rating Drop", type: "contra", explanation: "Elige a un rival de tu misma división; si acierta un combate que la mayoría predijo que ganaría el Face, solo suma la mitad de los puntos.", use: "Antes", orientation: "Divisional" },
            { id: 38, name: "The Gold Diggers", type: "contra", explanation: "Si un rival de tu misma división usa un comodín \"A Favor\" para obtener puntos extra, puedes robar 50% de esos puntos extra.", use: "Después", orientation: "Divisional" },
            { id: 39, name: "Injury Angle", type: "contra", explanation: "Elige a un rival de tu misma división; si acierta menos de la mitad de sus predicciones, le restas -6 puntos del total de la porra.", use: "Después", orientation: "Divisional" },
            { id: 40, name: "Losers Bracket", type: "contra", explanation: "Si el rival va en la mitad inferior de su división, su predicción más popular resta -2 puntos si acierta.", use: "Antes", orientation: "Media / Baja" },
            { id: 41, name: "False Finish", type: "contra", explanation: "Elige la predicción de un rival de tu misma división; si su luchador gana, pero el combate tiene un final rápido/polémico, pierde -3 puntos.", use: "Antes", orientation: "Divisional" },
            { id: 42, name: "Booking Block", type: "contra", explanation: "Anula cualquier comodín A Favor de un rival de tu misma división cuyo propósito sea añadir puntos extra.", use: "Antes", orientation: "Divisional" },
            { id: 43, name: "The Veteran's Gate", type: "contra", explanation: "Obliga a un rival de tu misma división a que su predicción más importante sea sobre un luchador veterano que tú elijas.", use: "Antes", orientation: "Divisional" },
            { id: 44, name: "Heel Turn", type: "contra", explanation: "Elige a un rival de tu misma división; si su predicción más importante es de un luchador Face, y gana, solo suma 2 puntos.", use: "Antes", orientation: "Divisional" },
            { id: 45, name: "Bad Booking", type: "contra", explanation: "Puedes cambiar el resultado de la predicción de un rival de tu misma división al menos popular entre todos los usuarios.", use: "Antes", orientation: "Divisional" },
            { id: 46, name: "Career Threat Match", type: "contra", explanation: "Si el rival de tu misma división acierta su predicción, y es un combate por un contrato/carrera, no suma ningún punto.", use: "Antes", orientation: "Divisional" },
            { id: 47, name: "The Forbidden Door", type: "contra", explanation: "Elige a un rival de tu misma división; su próximo comodín A Favor usado solo puede anular un comodín En Contra de la misma división.", use: "Antes / Durante", orientation: "Divisional" },
            { id: 48, name: "Championship Curse", type: "contra", explanation: "Elige la predicción de un rival de tu misma división; si es por un título mundial y el campeón retiene, la predicción resta -5 puntos si acierta.", use: "Antes", orientation: "Divisional" },
            { id: 49, name: "Unstoppable Dominator", type: "contra", explanation: "Elige a un rival de tu misma división que tenga un 80% o más de aciertos; su siguiente predicción solo le dará 1 punto si acierta.", use: "Durante", orientation: "Divisional" },
            { id: 50, name: "The Corporate Mandate", type: "contra", explanation: "Elige a un rival de tu misma división; si tiene dos predicciones con el mismo resultado, ambas restan -3 puntos si acierta una.", use: "Antes", orientation: "Divisional" }
        ];

        // Estado de la aplicación
        // AHORA PERMITE SELECCIÓN MÚLTIPLE para previsualizar.
        let temporarySelections = new Set(); 
        let isViewingSelections = false; 
        
        // Estado de los filtros
        const filters = {
            search: '',
            type: 'all',
            use: 'all', 
            orientation: 'all'
        };

        // Referencias a elementos del DOM
        const wildcardContainer = document.getElementById('wildcard-container');
        const searchInput = document.getElementById('search-input');
        const typeButtons = document.querySelectorAll('[data-filter-type]');
        const usoFilter = document.getElementById('uso-filter');
        const orientacionFilter = document.getElementById('orientacion-filter');
        const summaryBox = document.getElementById('summary-box');
        const selectedWildcardList = document.getElementById('selected-wildcard-list');
        const selectionCount = document.getElementById('selection-count');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const selectionForm = document.getElementById('selection-form');
        const discordUserSelectorInput = document.getElementById('discord-user-selector');
        const sendButton = document.getElementById('send-button');
        const statusMessage = document.getElementById('status-message');
        const viewSelectionBtn = document.getElementById('view-selection-btn');
        const div1Body = document.getElementById('clasificacion-div1');
        const div2Body = document.getElementById('clasificacion-div2');
        
        // --- Lógica de Pestañas ---

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.dataset.tab;

                // Ocultar todos los contenidos y desactivar todos los botones
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                tabButtons.forEach(btn => {
                    btn.classList.remove('border-b-4', 'border-indigo-500', 'text-indigo-400');
                    btn.classList.add('text-gray-400', 'hover:text-indigo-400');
                });

                // Mostrar el contenido objetivo y activar el botón
                document.getElementById(targetTab).classList.remove('hidden');
                button.classList.add('border-b-4', 'border-indigo-500', 'text-indigo-400');
                button.classList.remove('text-gray-400', 'hover:text-indigo-400');
            });
        });

        // --- Lógica de Clasificación ---

        /**
         * Genera una fila de la tabla de clasificación.
         * @param {Object} entry - Objeto de clasificación ({ position, user, score }).
         * @param {number} index - Índice de la fila (para alternar colores).
         * @returns {string} HTML de la fila.
         */
        function createStandingsRow(entry, index) {
            const rowClass = index % 2 === 0 ? 'table-row-odd' : 'table-row-even';
            const positionColor = index < 3 ? 'text-yellow-400' : 'text-gray-400';
            const avatarUrl = userAvatars[entry.user] || 'https://placehold.co/32x32/374151/ffffff?text=U'; // Avatar por defecto
            
            return `
                <tr class="${rowClass}">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${positionColor}">${entry.position}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex items-center">
                            <img src="${avatarUrl}" alt="Avatar de ${entry.user}" class="avatar" onerror="this.onerror=null;this.src='https://placehold.co/32x32/374151/ffffff?text=U';">
                            <span>${entry.user}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-gray-300">${entry.score}</td>
                </tr>
            `;
        }
        
        /**
         * Renderiza ambas tablas de clasificación.
         */
        function renderStandings() {
            // Renderizar 1ª División
            div1Body.innerHTML = standings.division1.map((entry, index) => 
                createStandingsRow(entry, index)
            ).join('');

            // Renderizar 2ª División
            div2Body.innerHTML = standings.division2.map((entry, index) => 
                createStandingsRow(entry, index)
            ).join('');
        }


        // --- Lógica de Comodines y Filtrado ---

        /**
         * Muestra un mensaje de estado (éxito o error).
         * @param {string} message - El mensaje a mostrar.
         * @param {string} type - 'success' o 'error'.
         */
        function showStatusMessage(message, type) {
            statusMessage.textContent = message;
            statusMessage.classList.remove('hidden', 'bg-red-800', 'text-red-200', 'bg-green-800', 'text-green-200');
            
            if (type === 'success') {
                statusMessage.classList.add('bg-green-800', 'text-green-200');
            } else if (type === 'error') {
                statusMessage.classList.add('bg-red-800', 'text-red-200');
            }

            // Ocultar el mensaje después de 5 segundos
            setTimeout(() => {
                statusMessage.classList.add('hidden');
            }, 5000);
        }

        /**
         * Maneja la selección/deselección de una tarjeta de comodín.
         * AHORA PERMITE SELECCIÓN MÚLTIPLE para previsualización.
         * @param {number} id - El ID del comodín.
         */
        function toggleWildcardSelection(id) {
            // Limpiar mensaje de estado al cambiar la selección
            statusMessage.classList.add('hidden');
            
            // Si ya está seleccionado, lo quitamos
            if (temporarySelections.has(id)) {
                temporarySelections.delete(id);
            } else {
                // Si no está seleccionado, lo añadimos (se permite selección múltiple)
                temporarySelections.add(id);
            }
            
            // Renderiza de nuevo la lista para actualizar las clases visuales y filtros
            renderWildcards();
            
            // Actualiza el resumen (que valida si hay 1 seleccionado para el envío)
            updateSummaryButton();
        }

        /**
         * Crea el elemento HTML para una tarjeta de comodín.
         * @param {Object} wildcard - Objeto comodín.
         * @returns {HTMLElement} El elemento div de la tarjeta.
         */
        function createWildcardCard(wildcard) {
            const isSelected = temporarySelections.has(wildcard.id);
            const typeClass = wildcard.type === 'favor' ? 'selected-favor' : 'selected-contra';
            const textClass = wildcard.type === 'favor' ? 'favor-text' : 'contra-text';
            const icon = wildcard.type === 'favor' ? '↑' : '↓'; // Usamos un icono simple

            const card = document.createElement('div');
            card.className = `card p-4 flex flex-col justify-between h-full ${isSelected ? typeClass : ''}`;
            card.dataset.id = wildcard.id;
            
            card.innerHTML = `
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-xl font-bold ${textClass}">${wildcard.name}</h3>
                        <span class="text-2xl font-black ${textClass}">${icon}</span>
                    </div>
                    <p class="text-sm text-gray-400 mb-3 italic">Uso: <span class="font-medium">${wildcard.use}</span> | Alcance: <span class="font-medium">${wildcard.orientation}</span></p>
                    <p class="text-gray-300 text-sm">${wildcard.explanation}</p>
                </div>
                <!-- Indicador de selección -->
                <div class="mt-4 text-center">
                    <span class="text-xs font-semibold uppercase tracking-wider ${isSelected ? 'text-white p-1 rounded-full' : 'text-gray-500'} ${isSelected ? (wildcard.type === 'favor' ? 'bg-green-600' : 'bg-red-600') : 'hidden'}">
                        ${isSelected ? 'SELECCIONADO' : ''}
                    </span>
                </div>
            `;

            card.addEventListener('click', () => {
                toggleWildcardSelection(wildcard.id);
            });

            return card;
        }

        /**
         * Aplica los filtros actuales al array de comodines.
         * @returns {Array} Array de comodines filtrados.
         */
        function getFilteredWildcards() {
            let list = wildcards;
            
            // Filtro de "Ver mi Selección"
            if (isViewingSelections) {
                // Solo devuelve los comodines cuyos IDs están en el Set de selecciones
                list = list.filter(w => temporarySelections.has(w.id));
                return list;
            }

            // Aplicar filtros normales (Búsqueda, Tipo, Uso, Orientación)
            return list.filter(wildcard => {
                // Filtro de Búsqueda
                const searchMatch = wildcard.name.toLowerCase().includes(filters.search.toLowerCase()) || 
                                    wildcard.explanation.toLowerCase().includes(filters.search.toLowerCase());
                if (!searchMatch) return false;

                // Filtro de Tipo
                const typeMatch = filters.type === 'all' || wildcard.type === filters.type;
                if (!typeMatch) return false;

                // Filtro de Uso
                const useMatch = filters.use === 'all' || wildcard.use === filters.use;
                if (!useMatch) return false;

                // Filtro de Orientación
                const orientacionMatch = filters.orientation === 'all' || wildcard.orientation === filters.orientation;
                if (!orientacionMatch) return false;

                return true;
            });
        }

        /**
         * Renderiza las tarjetas de comodines en el contenedor y actualiza contadores.
         */
        function renderWildcards() {
            const filteredList = getFilteredWildcards();
            wildcardContainer.innerHTML = ''; // Limpiar el contenedor
            
            const allButton = document.querySelector('[data-filter-type="all"]');
            const favorButton = document.querySelector('[data-filter-type="favor"]');
            const contraButton = document.querySelector('[data-filter-type="contra"]');
            
            const totalCount = wildcards.length; 
            const favorCount = wildcards.filter(w => w.type === 'favor').length;
            const contraCount = wildcards.filter(w => w.type === 'contra').length;
            
            // Actualizar contadores en los botones
            allButton.textContent = `Todos (${totalCount})`;
            favorButton.textContent = `A Favor (${favorCount})`;
            contraButton.textContent = `En Contra (${contraCount})`;
            viewSelectionBtn.textContent = `Ver mi Selección (${temporarySelections.size})`;


            if (filteredList.length === 0) {
                wildcardContainer.innerHTML = `<p class="text-center text-gray-400 col-span-full py-8">
                    ${isViewingSelections ? 'No has seleccionado ningún comodín.' : 'No se encontraron comodines con los filtros aplicados.'}
                </p>`;
                return;
            }

            filteredList.forEach(wildcard => {
                wildcardContainer.appendChild(createWildcardCard(wildcard));
            });
        }

        /**
         * Actualiza la caja de resumen con la selección actual.
         * Muestra TODOS los comodines seleccionados en la lista, pero solo habilita el envío si hay 1.
         */
        function updateSummaryButton() {
            const selectedIdsArray = Array.from(temporarySelections);
            const selectionCountValue = selectedIdsArray.length;
            selectionCount.textContent = selectionCountValue;
            selectedWildcardList.innerHTML = '';
            
            // Mostrar u ocultar la caja de resumen general
            if (selectionCountValue > 0) {
                summaryBox.classList.remove('hidden');

                // Listar TODAS las selecciones
                selectedIdsArray.forEach(id => {
                    const currentWildcard = wildcards.find(w => w.id === id);
                    if (currentWildcard) {
                        const textClass = currentWildcard.type === 'favor' ? 'text-green-400' : 'text-red-400';
                        const typeText = currentWildcard.type === 'favor' ? 'A FAVOR' : 'EN CONTRA';
                        const listItem = document.createElement('p');
                        listItem.className = 'text-base font-medium';
                        listItem.innerHTML = `• <span class="font-bold ${textClass}">${currentWildcard.name}</span> (<span class="${textClass}">${typeText}</span>)`;
                        selectedWildcardList.appendChild(listItem);
                    }
                });

                // Habilitar/Deshabilitar botón de envío (VALIDACIÓN DE REGLA)
                const isOneSelected = selectionCountValue === 1;
                sendButton.disabled = !isOneSelected;
                sendButton.classList.toggle('bg-gray-500', !isOneSelected);
                sendButton.classList.toggle('bg-green-600', isOneSelected);
                sendButton.classList.toggle('hover:bg-green-700', isOneSelected);
                
                if (isOneSelected) {
                    sendButton.textContent = 'Confirmar y Enviar Comodín a Discord';
                } else {
                    sendButton.textContent = `⚠ Selecciona solo 1 comodín para Enviar (Regla PPV)`;
                }


            } else {
                // Si no hay selecciones, ocultar el resumen
                summaryBox.classList.add('hidden');
                sendButton.disabled = true;
                sendButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                sendButton.classList.add('bg-gray-500');
                sendButton.textContent = `Selecciona 1 comodín para Enviar a Discord`;
            }
        }

        /**
         * Envía el mensaje al Webhook de Discord.
         * @param {string} selectorUser - Usuario de Discord que hace la selección.
         */
        async function sendDiscordWebhook(selectorUser) {
            // Se valida de nuevo, pero la UI ya solo permite llegar aquí si hay exactamente 1 seleccionado.
            if (temporarySelections.size !== 1) {
                showStatusMessage('❌ Debes seleccionar exactamente UN comodín para enviar (Regla: Un comodín por PPV).', 'error');
                return;
            }

            const selectedId = Array.from(temporarySelections)[0];
            const wildcard = wildcards.find(w => w.id === selectedId);
            
            if (!wildcard) return; 
            
            const color = wildcard.type === 'favor' ? 65280 : 16711680; // Verde o Rojo
            const typeText = wildcard.type === 'favor' ? "A Favor (Beneficio)" : "En Contra (Ataque)";
            
            // Mensaje de contenido para el chat
            const contentMessage = `¡@${selectorUser} ha elegido comodín! ¡Revisen las reglas de selección!`;

            // Construcción del footer
            let footerText = `Formato de chat: Elijo comodín ${wildcard.name}`;
            
            // Si es EN CONTRA, recordamos que debe enviar el objetivo por privado
            if (wildcard.type === 'contra') {
                footerText += `. (Recordatorio: debe enviar el @rival atacado por privado al administrador)`;
            } else {
                // Si es A FAVOR, aclaramos que la elección es pública y no necesita más
                footerText += `. (Este comodín A Favor es público y su uso está confirmado)`;
            }

            const payload = {
                username: "AstuPorra Bot", 
                avatar_url: "https://placehold.co/128x128/indigo/white?text=A", 
                content: contentMessage,
                embeds: [
                    {
                        title: `WILD CARD: ${wildcard.name} (${typeText})`,
                        description: `**USUARIO ELEGIDO:** @${selectorUser}`,
                        color: color,
                        fields: [
                            {
                                name: "Timing (Uso)",
                                value: wildcard.use,
                                inline: true
                            },
                            {
                                name: "Alcance",
                                value: wildcard.orientation,
                                inline: true
                            },
                            {
                                name: "Efecto",
                                value: wildcard.explanation,
                                inline: false
                            }
                        ],
                        footer: {
                            text: footerText
                        },
                        timestamp: new Date().toISOString()
                    }
                ]
            };

            try {
                // Deshabilitar botón mientras se envía
                sendButton.textContent = 'Enviando...';
                sendButton.disabled = true;

                const response = await fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                sendButton.textContent = 'Confirmar y Enviar Comodín a Discord';
                sendButton.disabled = false;


                if (response.ok) {
                    showStatusMessage(`✅ ¡Comodín '${wildcard.name}' enviado a Discord con éxito!`, 'success');
                    
                    // Limpiar solo el comodín enviado, no toda la selección múltiple
                    temporarySelections.delete(selectedId); 
                    discordUserSelectorInput.value = '';
                    renderWildcards();
                    updateSummaryButton();
                } else {
                    const errorText = await response.text();
                    console.error('Error al enviar Webhook:', response.status, errorText);
                    showStatusMessage(`❌ Error al enviar el comodín (Código: ${response.status}). Revisa la consola para más detalles.`, 'error');
                }
            } catch (error) {
                console.error('Error de red al enviar el Webhook:', error);
                sendButton.textContent = 'Confirmar y Enviar Comodín a Discord';
                sendButton.disabled = false;
                showStatusMessage('❌ Error de conexión. No se pudo contactar con Discord.', 'error');
            }
        }

        // --- Event Listeners ---

        // Listener para el envío del formulario
        selectionForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const selectedId = Array.from(temporarySelections)[0];
            
            // Validación RESTAURADA a un solo comodín para el ENVÍO
            if (temporarySelections.size !== 1) {
                showStatusMessage('❌ Debes seleccionar exactamente UN comodín para enviar (Regla: Un comodín por PPV).', 'error');
                return;
            }

            let selectorUser = discordUserSelectorInput.value.trim();

            if (!selectorUser || selectorUser.length < 2) {
                showStatusMessage('❌ Introduce @Tu Usuario de Discord (quién envía el comodín).', 'error');
                return;
            }

            // Limpiar el '@' si el usuario lo introdujo
            const cleanSelectorUser = selectorUser.startsWith('@') ? selectorUser.substring(1) : selectorUser;

            // Enviar el webhook
            sendDiscordWebhook(cleanSelectorUser);
        });


        // Listeners de Filtro

        searchInput.addEventListener('input', () => {
            filters.search = searchInput.value;
            isViewingSelections = false; // Desactiva la vista de selección al buscar
            renderWildcards();
        });

        typeButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Resetear estado 'active' en todos, excepto en "Ver mis Selecciones"
                typeButtons.forEach(btn => {
                    if (btn.dataset.filterType !== 'selection') {
                        btn.classList.remove('active', 'filter-btn-favor', 'filter-btn-contra');
                    }
                });
                viewSelectionBtn.classList.remove('active');
                
                const type = button.dataset.filterType; 
                filters.type = type;
                isViewingSelections = false; // Desactiva la vista de selección

                if (type !== 'selection') {
                    button.classList.add('active');
                    if (type === 'favor') button.classList.add('filter-btn-favor');
                    if (type === 'contra') button.classList.add('filter-btn-contra');
                }

                renderWildcards();
            });
        });

        // Listener para "Ver mi Selección"
        viewSelectionBtn.addEventListener('click', () => {
             // Resetear filtros visuales normales (excepto los de búsqueda)
             typeButtons.forEach(btn => {
                if (btn.dataset.filterType !== 'selection') {
                    btn.classList.remove('active', 'filter-btn-favor', 'filter-btn-contra');
                }
            });

            isViewingSelections = !isViewingSelections; // Cambiar el estado de visualización

            if (isViewingSelections) {
                viewSelectionBtn.classList.add('active', 'filter-btn-view');
                filters.type = 'all'; // Ignorar filtro de tipo normal
            } else {
                viewSelectionBtn.classList.remove('active', 'filter-btn-view');
                filters.type = 'all'; // Volver a mostrar todos
                document.querySelector('[data-filter-type="all"]').classList.add('active'); // Activar el botón "Todos"
            }
            renderWildcards();
        });

        usoFilter.addEventListener('change', (e) => {
            filters.use = e.target.value;
            isViewingSelections = false; // Desactiva la vista de selección al filtrar
            renderWildcards();
        });

        orientacionFilter.addEventListener('change', (e) => {
            filters.orientation = e.target.value;
            isViewingSelections = false; // Desactiva la vista de selección al filtrar
            renderWildcards();
        });
        
        // Inicialización al cargar el documento
        document.addEventListener('DOMContentLoaded', () => {
            // Renderizar los comodines iniciales
            renderWildcards();
            // Asegurar que el resumen esté oculto o muestre el estado inicial
            updateSummaryButton();
            // Renderizar la clasificación
            renderStandings();

            // Lógica para establecer el estado inicial de los botones de tipo
            document.querySelector('[data-filter-type="all"]').classList.add('active');
            
        });
    </script>
</body>
</html>
